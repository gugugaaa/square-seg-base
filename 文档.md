# YOLO12 Seg 和 OBB 极简摘要

基于最新文档（YOLO12 支持 seg 和 obb 任务，**未开放预训练权重**，需从 [Ultralytics GitHub](https://github.com/ultralytics/ultralytics/blob/main/ultralytics/cfg/models/12/) 下载 YAML 文件自行训练；API 与 YOLO11 一致，无重大差异）。  
**焦点：数据集格式和 API，针对自定义旋转重叠正方形任务。**

---

## 数据集格式（通用）

**结构：**
- `dataset/`
  - `images/train/`
  - `images/val/`
  - `labels/train/`
  - `labels/val/`
- 图像为 JPG/PNG
- 标签为 TXT（每图像一个 TXT 文件，同名，如 `img_0.jpg` → `img_0.txt`）

**YAML 配置（data.yaml）：**
```yaml
yamlpath: /path/to/dataset  # 根目录
train: images/train         # 训练图像路径
val: images/val             # 验证图像路径
nc: 1                       # 类数（1 为 square）
names: ['square']           # 类名
```

---

## Seg 标签格式（实例分割）

- 每行一个对象：`class_id` + 多边形点（归一化 0-1，按图像宽高）
- 对于旋转正方形：`class 0 x1 y1 x2 y2 x3 y3 x4 y4`（顺/逆时针顺序，4 点够用；支持更多点捕获复杂形状）

**示例 TXT：**
```
0 0.5 0.5 0.6 0.5 0.6 0.6 0.5 0.6
```

---

## OBB 标签格式（定向边界框）

- 每行一个对象：`class` + 精确 4 个角点（归一化 0-1，顺/逆时针）
- 内部处理为 xywhr（中心、宽高、弧度角，0-90°）

**示例 TXT：**
```
0 0.780811 0.743961 0.782371 0.74686 0.777691 0.752174 0.776131 0.749758
```

---

**注意：**
- 标签点需处理重叠（每个对象独立标注）
- 合成数据可自动化计算点
- 转换工具：
  - OBB: `ultralytics.data.converter.convert_dota_to_yolo_obb()`
  - Seg: `JSON2YOLO`（COCO 转）

---

## API（训练/验证，Python）

**安装：**
```bash
pip install ultralytics
```

**Seg 训练：**
```python
from ultralytics import YOLO
model = YOLO("yolov12n-seg.yaml")  # 下载 yaml 文件，自行训练
results = model.train(data="data.yaml", epochs=100, imgsz=640, batch=16)
```

**OBB 训练：**
- 类似，替换 `model=yolov12n-obb.yaml` 和 `task=obb`

**验证（评估 mAP、IoU 等）：**
```python
model = YOLO("runs/segment/train/weights/best.pt")
metrics = model.val(data="data.yaml")  # 访问 metrics.seg.map (Seg) 或 metrics.box.map (OBB)
```

**其他：**
- 预测：`model.predict(source="img.jpg")`
- 结果访问：`result.masks` (Seg) 或 `result.obb.xywhr` (OBB)
- 数据增强自动支持旋转/重叠

---